<!DOCTYPE HTML PUBLIC "-//Microsoft//DTD Internet Explorer 3.0 HTML//EN">
<HTML>

<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <TITLE>Leo Brodie's Starting Forth - Chapter 1</TITLE>
  <META name="description" content="Starting Forth, Leo Brodie, Chapter 1.">
  <META name="keywords" content="Forth, example code, Starting Forth, chapter 1">
</HEAD>

<BODY BGCOLOR="#F8F8F8" TEXT="#000000" LINK="#0000FF" VLINK="#007070" ALINK="#FF0000" TOPMARGIN=0>

<H1>1 Fundamental Forth</H1>

	<P> In this chapter we'll acquaint you with some of the unique properties of the Forth language. After a few
	    introductory pages we'll have you sitting at a Forth terminal.

<H2>A Living Language</H2>
	
	<P> Imagine that you're an office manager and you've just hired a new, eager assistant. On the first
	    day, you teach the assistant the proper format for typing correspondence. (The assistant already 
	    knows how to type.) By the end of the day, all you have to do is say "Please type this."

	<P> On the second day, you explain the filing system. It takes all morning to explain where everything 
	    goes, but by the afternoon all you have to say is "Please file this."

	<P> By the end of the week, you can communicate in a kind of shorthand, where "Please send this letter"
	    means "Type it, get me to sign it, photocopy it, file the copy, and mail the original." Both you
	    and your assistant are free to carry out your business more pleasantly and efficiently.

	<P> Good organization and effective communication require that you
		<OL>
		  <LI> define useful tasks and give each task a name, then
		  <LI> group related tasks together in larger tasks and give each of these a name, and so on.
		</OL>

	<P> Forth lets you organize your own procedures and communicate them to a computer in just this way 
	    (except you don't have to say "please").

	<P> As an example, imagine a microprocessor-controlled washing machine programmed in Forth. The ultimate
	    command in your example is named <TT>WASHER</TT>. Here is the definition of <TT>WASHER</TT>, as 
	    written in Forth:
<PRE>	: WASHER  WASH SPIN RINSE SPIN ;
</PRE>
	<P> In Forth, the colon indicates the beginning of a new definition. The first word after the colon, 
	    <TT>WASHER</TT>, is the name of the new procedure. The remaining words, <TT>WASH</TT>, <TT>SPIN</TT>, 
	    <TT>RINSE</TT> and <TT>SPIN</TT>, comprise the "definition" of the new procedure. Finally, the 
	    semicolon indicates the end of the definition.

<P><IMG SRC="washer.gif" ALIGN=MIDDLE ALT="washing machine">

	<P> Each of the words comprising the definition of <TT>WASHER</TT> has already been defined in our
	    washing-machine application. For example, let's look at our definition of <TT>RINSE</TT>:
<PRE>	: RINSE  FAUCETS OPEN  TILL-FULL  FAUCETS CLOSE ;
</PRE>
	<P> In this definition we are referring to <U>things</U> (faucets) as well as <U>actions</U> (open and 
	    close). The word <TT>TILL-FULL</TT> has been defined to create a "delay-loop" which does nothing
	    but mark time until the water-level switch has been activated, indicating that the tub is full.

	<P> If we were to trace these definitions back, we would eventually find that they are all defined
	    in terms of a group of very useful commands that form the basis of all Forth systems. For example,
	    a complete ANS Forth with all extensions includes 371 such commands. Many of these commands are
	    themselves "colon definitions" just like our example words; others are defined directly in the
	    machine language of the particular computer. In Forth, a defined command is called a "word."
	    <IMG SRC="footnote.gif" ALT="For Old Hands: This meaning of `word' is not to be associated with a 16-bit value.">

	<P> The ability to define a word in terms of other words is called "extensibility." Extensibility leads
	    to a style of programming that is extremely simple, naturally well-organized, and as powerful as you
	    want it to be.

	<P> Whether your application runs an assembly line, acquires data for a scientific environment, maintains
	    a business application, or plays a game, you can create your own "living language" of words that 
	    relate to your particular need.

	<P> In this book we'll cover the most useful of the standard Forth commands.

<H2>All This and ... Interactive!</H2>
	
	<P> One of Forth's many unique features is that it lets you "execute" <IMG SRC="footnote.gif" ALT="For Beginners: To `execute' a word is to order the computer to carry out a command.">
	    a word by simply naming the word. If you're working at a terminal keyboard, this can be as simple 
	    as typing in the word and pressing the <CODE>RETURN</CODE> key.

	<P> Of course, you can also use the same word in the definition of any other word, simply by putting 
	    its name in the definition.

	<P> Forth is called an "interactive" language because it carries out your commands the instant that
	    you enter them.

	<P> We're going to give an example that you can try yourself, showing the process of combining simple
	    commands into more powerful commands. We'll use some simple Forth words that control your terminal
	    screen. But first, let's get acquainted with the mechanics of "talking" to Forth through your 
	    terminal's keyboard.

	<P><IMG SRC="man_sitting.gif" ALIGN=LEFT ALT="man sitting on computer">  
	   <IMG SRC="woman_dreaming.gif" ALIGN=RIGHT ALT="woman dreaming of computer">

	<P> Take a seat at your real or imaginary Forth terminal. We'll assume that someone has been kind 
	    enough to set everything up for you, or that you have followed all the instructions given for 
	    loading Forth on your particular computer.

	<P> Now press the key labeled:
<PRE>	RETURN<IMG SRC="footnote.gif" ALT="For People At Terminals: RETURN may have a different name on your terminal. Other possible names are NEW LINE and ENTER.">
</PRE>

	<P> The computer will respond by saying
<PRE>	<U> ok </U>
</PRE>
	<P> The <CODE>RETURN</CODE> key is your way of telling Forth to acknowledge your request. The <U>ok</U> is Forth's
	    way of saying that it's done everything you asked it to do without any hangups. In this case, you
	    didn't ask it to do anything, so Forth obediently did nothing and said <U>ok</U>.

	<P> Now enter this:
<PRE>	15 SPACES
</PRE>
	<P> If you make a typing mistake, you can correct it by hitting the "backspace" key.<IMG SRC="footnote.gif" ALT="Most Forths support much more sophisticated command line editing. Experiment.">
	    Back up to the mistake, enter the correct letter, and continue. When you have typed the line 
	    correctly, press the <CODE>RETURN</CODE> key. (Once you press <CODE>RETURN</CODE>, it's too late to 
	    correct the line.)

	<P> In this book, we use the symbol <IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"> to mark the point where
	    you must press the <CODE>RETURN</CODE> key. We also underline the computer's output (even though
	    the computer does not) to indicate who is typing what.

	<P> Here's what has happened:
<PRE>	15 SPACES<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U>                ok </U>
</PRE>
	<P> As soon as you pressed the return key, Forth printed fifteen blank spaces and then, having processed
	    your request, responded <U> ok </U> (at the end of the fifteenth space).

	<P> Now enter this:
<PRE>	42 EMIT<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> * ok </U>
</PRE>
	<P> The phrase <CODE>"42 EMIT"</CODE> tells Forth to print an asterisk (we'll discuss this command
	    later on in the book.) Here Forth printed an asterisk, then responded <U>ok</U>.

	<P> We can put more than one command on the same line. For example:
<PRE>	15 SPACES  42 EMIT  42 EMIT<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U>               ** ok </U>
</PRE>
	<P> This time Forth printed fifteen spaces and two asterisks. A note about entering words and/or 
	    numbers: we can separate them from another by as many spaces as we want for clarity. But they
	    must be separated by <U>at</U> <U>least</U> <U>one</U> <U>space</U> for Forth to be able to 
	    recognize them as words and/or numbers.

	<P> Instead of entering the phrase
<PRE>	42 EMIT
</PRE>
	    over and over, let's define it as a word called <TT>"STAR."</TT>

	<P> Enter this:
<PRE>	: STAR  42 EMIT ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U>
</PRE>
	<P> Here <TT>STAR</TT> is the name; <CODE>"42 EMIT"</CODE> is the definition. Notice that we set off 
	    the colon and semicolon from adjacent words with a space. Also, to make Forth definitions easy for
	    human beings to read, we conventionally separate the name of the definition from its contents with
	    three spaces.

	<P> After you have entered the above definitions and pressed <TT>RETURN</TT>, Forth responds <U>ok</U>,
	    signifying that it has recognized your definition and will remember it. Now enter
<PRE> 	STAR<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> * ok </U>
</PRE>
	<P> Voila! Forth executes your definition of <TT>"STAR"</TT> and prints an asterisk.

	<P> There is no difference between a word such as <TT>STAR</TT> that you define yourself and a word
	    such as <FONT COLOR="#0000FF">EMIT</FONT> that is already defined. In this book, however, we will
	    print those words that are already defined in <FONT COLOR="#0000FF">blue</FONT>, so that you can 
	    more easily tell the difference.

	<P> Another system-defined word is <FONT COLOR="#0000FF">CR</FONT>, which performs a carriage return
	    and line feed at your terminal.<IMG SRC="footnote.gif" ALT="For Beginners: Be sure to distinguish between the key labeled RETURN and the Forth word CR.">
	    For example, enter this:
<PRE>	CR<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> </U>
	<U> ok </U>
</PRE>
	<P> As you can see, Forth executed a carriage return, then printed <U>ok</U> (on the next line).

	<P> Now try this:
<PRE>	CR STAR CR STAR CR STAR<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key">
	<U>*</U>
	<U>*</U>
	<U>* ok </U>
</PRE>
	<P> Let's put a <FONT COLOR="#0000FF">CR</FONT> in a definition, like this:
<PRE>	: MARGIN   CR 30 SPACES ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U> 
</PRE>
	<P> Now we can enter
<PRE>	MARGIN STAR MARGIN STAR MARGIN STAR<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key">
</PRE>
	    and get three stars lined up vertically, thirty spaces in from the left.

	<P> Our <TT>MARGIN STAR</TT> combination will be useful for what we intend to do, so let's define
<PRE>	: BLIP   MARGIN STAR ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U>
</PRE>
	<P> We will also need to print a a horizontal row of stars. So let's enter the following definition
	    (we'll explain how it works in a later chapter):
<PRE>	: STARS   0 DO  STAR  LOOP ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U>
</PRE>
	<P> Now we can say
<PRE> 	5 STARS<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ***** ok </U>
</PRE>
	    or
<PRE> 	35 STARS<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> *********************************** ok </U>
</PRE>
	or any number of stars imaginable.

	<P> We will need a word which performs <TT>MARGIN</TT>, then prints five stars. Let's define it like 
	    this:
<PRE>	: BAR   MARGIN  5 STARS ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U>
</PRE>
	<P> Now we can enter
<PRE>	BAR BLIP BAR BLIP BLIP  CR
</PRE>
	    and get a letter "F" (for <U>F</U>orth) made up of stars. It should look like this:
<PRE>				      *****
				      *
				      *****
				      *
				      *
</PRE>
	<P> The final step is to make this new procedure a word. Let's call the word "F":
<PRE>	: F   BAR BLIP BAR BLIP BLIP  CR ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U>
</PRE>
	<P> You've just seen an example of the way simple Forth commands can become a foundation for more
	    complex commands. A Forth application, when listed, consists of a series of increasingly powerful
	    definitions rather than a sequence of instructions to be executed in order.

	<P> To give you a sample of what a Forth application really looks like, here's a listing of our
	    experimental application:
<P>
<PRE>	( Large letter F )
	: STAR    42 EMIT ;
	: STARS   0 DO  STAR  LOOP ;
	: MARGIN  CR 30 SPACES ;
	: BLIP    MARGIN STAR ;
	: BAR     MARGIN 5 STARS ;
	: F       BAR BLIP BAR BLIP BLIP CR ;
</PRE>

<H2>The Dictionary</H2>

	<P> Each word and its definition are entered into Forth's "dictionary." The dictionary already 
	    contained many words when you started, but your own words are now in the dictionary as well.

	<P> <IMG SRC="book.gif" ALIGN=RIGHT ALT="dictionary">
	    When you define a new word, Forth translates your definition into dictionary form and writes 
	    the entry in the dictionary. This process is called "compiling."<IMG SRC="footnote.gif" ALT="For Beginners: Compilation is a general computer term which normally means the translation of a high-level program into machine code that the computer can understand. In Forth it means the same thing, but specifically it means writing into the dictionary.">
	
	<P> <IMG SRC="monk-asterisk.gif" ALIGN=LEFT ALT="bald-headed John writing">
	    For example, when you enter the line
<PRE>	: STAR   [CHAR] * EMIT ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U>
</PRE>
	    the compiler compiles the new definition (it does the same as <TT>"42 EMIT"</TT> but 
	    doesn't use magic numbers) into the dictionary. The compiler does <U>not</U> print the asterisk.
	
	<P> Once a word is in the dictionary, how is it executed? Let's say you enter the following line 
	    directly at your terminal (not inside a definition):
<PRE>	STAR 30 SPACES<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key">
</PRE>
	<P> This will activate a word called <FONT COLOR="#0000FF">INTERPRET</FONT>, also known as the
	    "text interpreter." <IMG SRC="interpret.gif" ALIGN=RIGHT ALT="interpreter looking for space">
	    The text interpreter scans the input stream, looking for strings of 
	    characters separated by spaces. When a string is found, it is looked up in the dictionary.
	    If the word is in the dictionary, it is pointed out to a word called <FONT COLOR="#0000FF">EXECUTE</FONT>.
	    <FONT COLOR="#0000FF">EXECUTE</FONT> executes the definition (in this case an asterisk is printed). 
	    Finally, the interpreter says everything's "ok."

	<P> <IMG SRC="runner.gif" ALIGN=LEFT ALT="number runner sprints to stack">
	    If the interpreter cannot find the string in the dictionary, he calls the number-runner 
	    (called <FONT COLOR="#0000FF">NUMBER</FONT>). <FONT COLOR="#0000FF">NUMBER</FONT> knows a number 
	    when he sees one. If <FONT COLOR="#0000FF">NUMBER</FONT> finds a number, he runs it off to a 
	    temporary storage location for numbers.

	<P> What happens when you try to execute a word that is not in the dictionary? Enter this and see what 
	    happens:
<PRE>	XLERB<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> XLERB ? </U>
</PRE>
	
	<P> <IMG SRC="xlerb.gif" ALIGN=RIGHT ALT="XLERB??">
	    When the text interpreter cannot find <TT>XLERB</TT> in the dictionary, it tries to pass it off
	    on <FONT COLOR="#0000FF">NUMBER</FONT>. <FONT COLOR="#0000FF">NUMBER</FONT> shines it on. Then the
	    interpreter returns the string to you with a question mark (Some Forths print various error messages 
	    along with this.)

	<P> ANS Forth allows up to thirty-one characters of a name to be stored in the dictionary. A name 
	    should contain only graphic characters.

	<P> To summarize: when you type a pre-defined word at the terminal, it gets interpreted and then 
	    executed.

	<P> Now remember we said that <FONT COLOR="#0000FF"><B><B>:</B></B></FONT> is a word? When you type the word
	    <FONT COLOR="#0000FF"><B>:</B></FONT>, as in
<PRE>	: STAR   [CHAR] * EMIT ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key">
</PRE>
	    the following occurs:
	<P> The text interpreter finds the colon in the input stream, and points it out to <FONT COLOR="#0000FF">EXECUTE</FONT>.
	    The compiler translates the definition into dictionary form and writes it in the dictionary. When 
	    the compiler gets to the semicolon, he stops, and execution returns to the text interpreter, 
	    who gives the message <U>ok</U>.

<H2>Say What?</H2>

	<P> In Forth, a word is a character or group of characters that have a definition. Almost any character
	    can be used in naming a word. The reasons that some of the control characters cannot be used are:

<P>	
<TABLE WIDTH="70%" BORDER="0">
	<TR> <TD bgcolor="#EEEEEE"> return	<TD bgcolor="#EEEEEE"> because the computer thinks you've finished entering.
	<TR> <TD bgcolor="#EEEEEE"> backspace	<TD bgcolor="#EEEEEE"> because the computer thinks you are trying to correct a typing error.
	<TR> <TD bgcolor="#EEEEEE"> space 	<TD bgcolor="#EEEEEE"> because the computer thinks it's the end of the word.
</TABLE>
	
	<P> Here is a Forth word whose name consists of two punctuation marks. The word is <FONT COLOR="#0000FF">."</FONT> and
	    it is pronounced <U>dot-quote</U>. You can use <FONT COLOR="#0000FF">."</FONT> inside a definition
	    to type a string of text at your terminal. Here's an example:
<PRE>	: GREET   ." Hello, I speak Forth " ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> ok </U>
</PRE>
	<P> We've just defined a word called <TT>GREET</TT>. It's definition consists of just one Forth word,
	    <FONT COLOR="#0000FF">."</FONT>, followed by the text that we want typed. The quotation mark at the
	    <U>end</U> of the text will not be typed; it marks the end of the text. It's called a "delimiter."

	<P> When entering the definition of <TT>GREET</TT>, don't forget the closing <FONT COLOR="#0000FF"><B>;</B></FONT>
	    to end the definition.

	<P> Let's execute <TT>GREET</TT>:
<PRE>	GREET<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> Hello, I speak Forth  ok </U>
</PRE>
	
<H2>The Stack: Forth's Worksite for Arithmetic</H2>
	
	<P> A computer would not be much good if it couldn't do arithmetic. If you never studied computers 
	    before, it may seem pretty amazing that a computer (or even a pocket calculator) can do 
	    arithmetic at all. We can't cite all the mechanics in this book, but believe us, it's not a 
	    miracle.

	<P> In general, computers perform their operations by breaking everything they do into ridiculously
	    tiny pieces of information and ridiculously easy things to do. To you and me, "3 + 4" is just
	    "7," without even thinking. To a computer, "3 + 4" is actually a very long list of things to do
	    and remember.

	<P> Without getting too specific, let's say you have a pocket calculator which expects its buttons
	    to be pushed in this order:
<P><IMG SRC="eq1.gif" ALIGN=MIDDLE ALT="equation #1">

	<P> in order to perform the addition and display the result. Here's a generalized picture of what
	    might occur:

	<P> <U>When</U> <U>you</U> <U>press</U>
<P><IMG SRC="eq2.gif" ALIGN=MIDDLE ALT="equation #2"> 
	<P> --the number 3 goes into one place (called Box A).
<P><IMG SRC="eq3.gif" ALIGN=MIDDLE ALT="equation #3">
	<P> --the intended operation (addition) is remembered somehow.
<P><IMG SRC="eq4.gif" ALIGN=MIDDLE ALT="equation #4">
	<P> --the number 4 is stored into a second place (called Box B).
<P><IMG SRC="eq5.gif" ALIGN=MIDDLE ALT="equation #5">
	<P> --the calculator performs the operation that is stored in the "Next Operation" Box on the contents
	    of the number boxes and leaves the result in Box A.

	<P> Many calculators and computers approach arithmetic problems in a way similar to what we've just
	    described. You may not be aware of it, but these machines are actually storing numbers in various
	    locations and then performing operations on them.

	<P> In Forth, there is <U>one</U> central location where numbers are temporarily stored before being operated on.
	    That location is called the "stack." Numbers are "pushed onto the stack," and <U>then</U> operations
	    work on the numbers on the stack.

	<P> The best way to explain the stack is to illustrate it. If you enter the following line at your 
	    terminal:
<PRE>	3 4 + .<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> 7 ok </U>
</PRE>	
	    here is what happens, key by key.

	<P> <IMG SRC="adder.gif" ALIGN=RIGHT ALT="Adding machine">

	<P> Recall that when you enter a number at your terminal, the text interpreter hands it over to
	    <FONT COLOR="#0000FF">NUMBER</FONT>, who runs it to some location. That location, it can now be 
	    told, is the stack. In short, when you enter the number three from the terminal, you push it onto
	    the stack.

	<P> Now the four goes onto the "top" of the stack and pushes the three downward. 
	<P> The next word in the input stream <U>can</U> be found in the dictionary. <FONT COLOR="#0000FF">+</FONT>
	    has been previously defined to "take the top two numbers off the stack, add them, and push the
	    result back onto the stack."
	
	<P> <IMG SRC="terminal.gif" ALIGN=MIDDLE ALT="Get it printed">
	<P> The next word, <FONT COLOR="#0000FF"><B>.</B></FONT>, is also found in the dictionary. It has been previously
	    defined to take the number off the stack and print it at the terminal.

<H2>Postfix Power</H2>
	
	<P> Now wait, you say. Why does Forth want you to type
<PRE>	3 4 +
</PRE>
	    instead of
<PRE>	3 + 4
</PRE>
	    which is more familiar to most people?

	<P> Forth uses "postfix" notation (so called because the operator is affixed <U>after</U> the numbers)
	    rather than "infix" notation (so called because the operator is affixed <U>in-between</U> the numbers)
	    so that all words which "need" numbers can get them from the stack.<IMG SRC="footnote.gif" ALT="For Pocket-calculator Experts: High-end Hewlett-Packard calculators feature a stack and postfix arithmetic.">

	<P> For example:
	<UL>
	 <LI>the word <FONT COLOR="#0000FF">+</FONT> gets two numbers from the stack and adds them;
	 <LI>the word <FONT COLOR="#0000FF"><B>.</B></FONT> gets one number from the stack and prints it;
	 <LI>the word <FONT COLOR="#0000FF">SPACES</FONT> gets one number from the stack and prints that many spaces;
	 <LI>the word <FONT COLOR="#0000FF">EMIT</FONT> gets a number that represents a character and prints that character;
	 <LI>even the word <TT>STARS</TT>, which we defined ourselves, gets a number from the stack and prints that many stars.
	</UL>
	
	<P> When <U>all</U> operators are defined to work on the values that are already on the stack, interaction
	    between many operations remains simple even when the program gets complex.

	<P> Earlier we pointed out that Forth lets you execute a word in either of two ways: by simply naming
	    it, or by putting it in the definition of another word and naming <U>that</U> word. Postfix is part
	    of what makes this possible.

	<P> Just as an example, let's suppose we wanted a word that will always add the number 4 to whatever 
	    number is on the stack (for no other purpose than to illustrate our point). Let's call the word
<PRE> 	FOUR-MORE
</PRE>
	<P> We could define it this way:
<PRE>	: FOUR-MORE    4 + ;<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key">
</PRE>
	    and test it this way:
<PRE>	3 FOUR-MORE .<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> 7 ok </U>
</PRE>
	    and again:
<PRE>	-10 FOUR-MORE .<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> -6 ok </U>
</PRE>
	<P> The "4" <U>inside</U> the definition goes onto the stack, just as it would if it were outside
	    a definition. Then the <FONT COLOR="#0000FF">+</FONT> adds the two numbers on the stack. Since
	    <FONT COLOR="#0000FF">+</FONT> always works on the stack, it doesn't care that the "4" came from
	    inside the definition and the three from outside.

	<P> As we begin to give some more complicated examples, the value of the stack and of postfix 
	    arithmetic will become increasingly apparent to you. The more operators that are involved,
	    the more important it is that they all be able to "communicate" with each other.

<H2>Keep Track of Your Stack</H2>
	
	<P> We've just begun to demonstrate the philosophy behind the stack and postfix notation. Before
	    we continue, however, let's look more closely at the stack in action and get accustomed  to its
	    peculiarities.

	<P> Forth's stack is described as a "last-in, first-out" (LIFO). You can see from the earlier 
	    illustration why this is so. The three was pushed onto the stack first, then the four pushed on
	    top of it. Later the adding machine took the four off first because it was on top. Hence "last-in,
	    first-out."

	<P> In general, the only accessible value at any given time is the top value. Let's use another operation,
	    the <FONT COLOR="#0000FF"><B>.</B></FONT> to further demonstrate. Remember that each <FONT COLOR="#0000FF"><B>.</B></FONT>
	    removes one number from the stack and prints it. Four dots, therefore, remove four numbers and 
	    print them.
<PRE>	2 4 6 8 . . . .<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> 8 6 4 2 ok </U>
</PRE>
	<P> The system reads input from left to right and executes each word in turn.
        <UL>
	 <LI>For input, the rightmost value on the screen will end up on the <U>top</U> of the stack.
	 <LI>For output, the rightmost value on the screen came from the <U>bottom</U> of the stack.
        </UL>
	
	<P> Let's see what kind of trouble we can get ourselves into. Type:
<PRE>	10 20 30 . . . .
</PRE>
	    (that's <U>four</U> dots) then <TT>RETURN</TT>. What you get is:

<PRE>	10 20 30 . . . .<IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key"><U> 30 20 10 0 Stack empty</U><IMG SRC="footnote.gif" ALT="For the Curious: Actually, dot always prints whatever is on the top, so if there is nothing on the stack, it prints whatever is just below the stack, which is usually zero. Only then is the error detected; the offending word (in this case dot) is returned to the screen, followed by the `error message.'">
</PRE>
	<P> Each dot removes one value. The fourth dot found that there was no value left on the stack to send
	    to the terminal, and it told you so.

<P><IMG SRC="stack-empty.gif" ALIGN=RIGHT ALT="Oeps, stack empty">

	<P> This error is called "stack underflow." (Notice that a stack underflow is <U>not</U> "ok.")
	
	<P> The opposite condition, when the stack completely fills up, is called "stack overflow." The stack
	    is so deep, however, that this condition should never occur except when you've done something
	    terribly wrong.

	<P> It's important to keep track of new words' "stack effects"; that is, the sort of numbers a word
	    needs to have on the stack before you execute it, and the sort of numbers it will leave on the 
	    stack afterwards.

	<P> If you maintain a list of your newly created words with their meanings as you go, you or anyone 
	    else can easily understand the word's operations. In Forth, such a list is called a "glossary."

	<P> To communicate stack effects in a visual way, Forth programmers conventionally use a special 
	    stack notation in their glossaries or tables of words. We're introducing the stack notation now
	    so that you'll have it under your belt when you begin the next chapter.

	<P> Here is the basic form:
<PRE>	( before -- after )
</PRE>	
	<P> The dash separates the things that should be on the stack (before you execute the word) from the
	    things that will be left there afterwards. For example, here's the stack notation for the word
	    <FONT COLOR="#0000FF"><B>.</B></FONT>:
<PRE>	.   ( n -- )
</PRE>
	<P> (The letter "n" stands for "number.") This shows that <FONT COLOR="#0000FF"><B>.</B></FONT> expects one
	    number on the stack (before) and leaves <U>no</U> number on the stack (after).

	<P> Here's the stack notation for the word <FONT COLOR="#0000FF">+</FONT>.
<PRE>	+   ( n1 n2 -- sum )
</PRE>
	<P> When there is more than one n, we number them n1, n2, n3, etc., consecutively. The numbers 1 and 2
	    do <U>not</U> refer to a position on the stack. Stack position is indicated by the order in which
	    the items are written; the <U>rightmost</U> item on either side of the arrow is the <U>topmost</U>
	    item on the stack. For example, in the stack notation of <FONT COLOR="#0000FF">+</FONT>, the n2 is
	    on top:
	<P><IMG SRC="top.gif" ALIGN=MIDDLE ALT="Point to top">
	<P> Since you probably have the hang of it by now, we'll be leaving out the <IMG SRC="enterkey.gif" ALIGN=MIDDLE ALT="enter key">
	    symbol except when we feel it's needed for clarity. You can usually tell where to press "return"
	    because the computer's response is always underlined.

	<P> Here's a list of the Forth words you've learned so far, including their stack notations ("n" stands
	    for number; "c" stands for character):

<P><TABLE WIDTH="100%" BORDER="0">
	<TR><TD bgcolor="#EEEEEE" nowrap> <TT>: xxxx   yyy ;</TT> <TD bgcolor="#EEEEEE" nowrap> ( -- )	<TD bgcolor="#EEEEEE"> Creates a new definition with the name <I>xxx</I>, consisting of word or words <I>yyy</I>.
	<TR><TD bgcolor="#EEEEEE"> <TT>CR</TT> 	   <TD bgcolor="#EEEEEE" nowrap> ( -- )			<TD bgcolor="#EEEEEE"> Performs a carriage return and line feed at your terminal.
	<TR><TD bgcolor="#EEEEEE"> <TT>SPACES</TT> <TD bgcolor="#EEEEEE" nowrap> ( n -- )		<TD bgcolor="#EEEEEE"> Prints the given number of blank spaces at your terminal.
	<TR><TD bgcolor="#EEEEEE"> <TT>SPACE</TT>  <TD bgcolor="#EEEEEE" nowrap> ( -- )			<TD bgcolor="#EEEEEE"> Prints one blank space at your terminal.
	<TR><TD bgcolor="#EEEEEE"> <TT>EMIT</TT>   <TD bgcolor="#EEEEEE" nowrap> ( c -- )		<TD bgcolor="#EEEEEE"> Transmits a character to the output device.
	<TR><TD bgcolor="#EEEEEE"> <TT>." xxx"</TT><TD bgcolor="#EEEEEE" nowrap> ( -- )			<TD bgcolor="#EEEEEE"> Prints the character string <I>xxx</I> at your terminal. The " character terminates the string.
	<TR><TD bgcolor="#EEEEEE"> <TT>+</TT> 	   <TD bgcolor="#EEEEEE" nowrap> ( n1 n2 -- sum )	<TD bgcolor="#EEEEEE"> Adds.
	<TR><TD bgcolor="#EEEEEE"> <TT><B>.</B></TT><TD bgcolor="#EEEEEE" nowrap> ( n -- )		<TD bgcolor="#EEEEEE"> Prints a number, followed by one space.
</TABLE>

	<P> In the next chapter we'll talk about getting the computer to perform some fancier arithmetic.
<P>	
<TABLE WIDTH="100%" BORDER="0">
	<CAPTION><I>Review of Terms</I></CAPTION>
	<TR> <TH> <HR NOSHADE SIZE="6"> <TH> <HR NOSHADE SIZE="6">
	<TR> <TD bgcolor="#EEEEEE"> Compile			    <TD bgcolor="#EEEEEE"> to generate a dictionary entry in computer memory from source text (the written-out form of a definition). Distinct from "execute."
	<TR> <TD bgcolor="#EEEEEE"> Dictionary		  	    <TD bgcolor="#EEEEEE"> in Forth, a list of words and definitions including both "system" definitions (pre-defined) and "user" definitions (which you invent). A dictionary resides in computer memory in compiled form.
	<TR> <TD bgcolor="#EEEEEE"> Execute 	 		    <TD bgcolor="#EEEEEE"> to perform. Specifically, to execute a word is to perform the operations specified in the compiled definition of the word.
	<TR> <TD bgcolor="#EEEEEE"> Extensibility	  	    <TD bgcolor="#EEEEEE"> a characteristic of a computer language which allows a programmer to add new features or modify existing ones.
	<TR> <TD bgcolor="#EEEEEE"> Glossary		  	    <TD bgcolor="#EEEEEE"> a list of words defined in Forth, showing their stack effects and an explanation of what they do, which serves as a reference for programmers.
	<TR> <TD bgcolor="#EEEEEE"> Infix notation		    <TD bgcolor="#EEEEEE"> the method of writing operators between the operands they affect, as in "2 + 5."
	<TR> <TD bgcolor="#EEEEEE"> Input stream		    <TD bgcolor="#EEEEEE"> the text to be read by the text interpreter. This may be text that you have just typed in at your terminal, or it may be text that is stored on disk.
	<TR> <TD bgcolor="#EEEEEE"> Interpret			    <TD bgcolor="#EEEEEE"> (when referring to Forth's text interpreter) to read the input stream, then to find each word in the dictionary or, failing that, to convert it to a number.
	<TR> <TD bgcolor="#EEEEEE"> LIFO			    <TD bgcolor="#EEEEEE"> (last-in, first-out) the type of stack which Forth uses. A can of tennis balls is a LIFO structure; the last ball you drop in is the one you must remove first.
	<TR> <TD bgcolor="#EEEEEE"> Postfix notation		    <TD bgcolor="#EEEEEE"> the method of writing operators after the operands they affect, as in "2 5 +" for "2 + 5." Also known as Reverse Polish Notation.
	<TR> <TD bgcolor="#EEEEEE"> Stack			    <TD bgcolor="#EEEEEE"> in Forth, a region of memory which is controlled in such a way that data can be stored or removed in a last-in, first-out (LIFO) fashion.
	<TR> <TD bgcolor="#EEEEEE"> Stack overflow		    <TD bgcolor="#EEEEEE"> the error condition that occurs when the entire area of memory allowed for the stack is completely filled with data.
	<TR> <TD bgcolor="#EEEEEE"> Stack underflow		    <TD bgcolor="#EEEEEE"> the error condition that occurs when an operation expects a value on the stack, but there is no valid data on the stack.
	<TR> <TD bgcolor="#EEEEEE"> Word			    <TD bgcolor="#EEEEEE"> in Forth, the name of a definition.
	<TR> <TH> <HR NOSHADE SIZE="6"> <TH> <HR NOSHADE SIZE="6">
</TABLE>

<H2>Problems -- Chapter 1</H2>
			<IMG SRC="felix.gif" ALIGN=MIDDLE ALT="problems">

	<P> Note: before you work these problems, remember these simple rules:
<PRE>	Every <FONT COLOR="#0000FF"><B>:</B></FONT> needs a <FONT COLOR="#0000FF"><B>;</B></FONT>.
</PRE>
	and
<PRE>	Every <FONT COLOR="#0000FF">."</FONT> needs a ".
</PRE>

<OL>
	<LI> Define a word called <TT>GIFT</TT> which, when executed, will type out the name of some gift.
	     For example, you might try:
<PRE>	: GIFT  ." Bookends " ;
</PRE>	
	<P> Now define a word called <TT>GIVER</TT> which will print out a person's first name. Finally,
	    define a word called <TT>THANKS</TT> which includes the new Forth words <TT>GIFT</TT> and
	    <TT>GIVER</TT>, and prints out a message something like this:
<PRE>	<U>Dear Stephanie,</U>
		<U>thanks for the Bookends. ok </U>
</PRE>	     <A HREF="1-1.forth.html">[answer]</A>
	<LI> Define a word called <TT>TEN.LESS</TT> which takes a number on the stack, subtracts ten, and 
	     returns the answer on the stack. (Hint: you can use <FONT COLOR="#0000FF">+</FONT>.)
	     <A HREF="1-2.forth.html">[answer]</A>
	<LI> After entering the words in Prob. 1, enter a new definition for <TT>GIVER</TT> to print
	     someone else's name, then execute <TT>THANKS</TT> again. Can you explain why <TT>THANKS</TT>
	     still prints out the first giver's name?
	     <A HREF="1-3.forth.html">[answer]</A>
</OL>

<A HREF="http://validator.w3.org"><IMG SRC="http://validator.w3.org/images/vh32.gif" HEIGHT=31 WIDTH=88 ALIGN=RIGHT BORDER=0 ALT="Valid HTML 3.5"></A>
</BODY>

</HTML>